//
// Created by mayak on 6/25/25.
//

#include "builtin_math/math_std.hpp"
#include "utils/test_functions_helpers.hpp"

#include <gtest/gtest.h>


TEST(STD_Combine, Float) {
    // SET VALUES -------------------------------------------------------------------------------
    constexpr size_t len = 10;

    std::vector<float> input1 =
        {0.1, 0.254, 0.78941, 9.254, 78.1654, 10451.22, 2.3, 124.2, -78.4599, 3.669};

    std::vector<float> input2 = {
        10.00000000000000,
        10.15400000000000,
        10.68941000000000,
        19.15400000000000,
        88.06540000000001,
        10461.11999999999898,
        12.20000000000000,
        134.09999084472656,
        -68.55990000000000,
        13.56900000000000,
    };

    std::vector<float> expected = {10.1,
                                   10.408,
                                   11.47882,
                                   28.407999038696289,
                                   166.23080000000002,
                                   20912.339999999997,
                                   14.5,
                                   258.29999084472655,
                                   -147.0198,
                                   17.238};
    std::vector<float> actual(len);

    // CALL FUNCTION ----------------------------------------------------------------------------
    math_std::combine<float>(input1, input2, actual);

    // COMAPRE RESULTS --------------------------------------------------------------------------
    gtest_utils::test::compare_spans<float>(expected, actual);
}


TEST(STD_Combine, ComplexFloat) {
    // SET VALUES -------------------------------------------------------------------------------
    constexpr size_t len = 5;

    std::vector<std::complex<float>> input1 = {{0, 0},
                                               {1.0f, 2.0f},
                                               {3.69f, 1.51f},
                                               {0.59f, 2.99f},
                                               {6.98f, 1.95f}};

    std::vector<std::complex<float>> input2 = {{1.000000000000f, 0.000000000000f},
                                               {-1.131204383757f, 2.471726672005f},
                                               {2.433080099726f, 39.970863001202f},
                                               {-1.783299953025f, 0.272425183182f},
                                               {-397.914174729263f, 998.555859856817f}};

    std::vector<std::complex<float>> expected = {
        {1.0000000, 0.0000000},
        {-0.13120436668395996, 4.4717264175415039},
        {6.1230801, 41.4808630},
        {-1.1933000, 3.2624252},
        {-390.9341747, 1000.5058599},
    };
    std::vector<std::complex<float>> actual(len);

    // CALL FUNCTION ----------------------------------------------------------------------------
    math_std::combine<std::complex<float>>(input1, input2, actual);

    // COMAPRE RESULTS --------------------------------------------------------------------------
    gtest_utils::test::compare_spans<std::complex<float>>(expected, actual);
}


TEST(STD_Combine_Inplace, Float) {
    // SET VALUES -------------------------------------------------------------------------------
    std::vector<float> actual =
        {0.1, 0.254, 0.78941, 9.254, 78.1654, 10451.22, 2.3, 124.2, -78.4599, 3.669};

    const std::vector<float> input2 = {
        10.00000000000000,
        10.15400000000000,
        10.68941000000000,
        19.15400000000000,
        88.06540000000001,
        10461.11999999999898,
        12.20000000000000,
        134.09999084472656,
        -68.55990000000000,
        13.56900000000000,
    };

    std::vector<float> expected = {10.1,
                                   10.408,
                                   11.47882,
                                   28.407999038696289,
                                   166.23080000000002,
                                   20912.339999999997,
                                   14.5,
                                   258.29999084472655,
                                   -147.0198,
                                   17.238};

    // CALL FUNCTION ----------------------------------------------------------------------------
    math_std::combine_inplace<float>(actual, input2);

    // COMAPRE RESULTS --------------------------------------------------------------------------
    gtest_utils::test::compare_spans<float>(expected, actual);
}


TEST(STD_Combine_Inplace, ComplexFloat) {
    // SET VALUES -------------------------------------------------------------------------------
    std::vector<std::complex<float>> actual = {{0, 0},
                                               {1.0f, 2.0f},
                                               {3.69f, 1.51f},
                                               {0.59f, 2.99f},
                                               {6.98f, 1.95f}};

    std::vector<std::complex<float>> input2 = {{1.000000000000f, 0.000000000000f},
                                               {-1.131204383757f, 2.471726672005f},
                                               {2.433080099726f, 39.970863001202f},
                                               {-1.783299953025f, 0.272425183182f},
                                               {-397.914174729263f, 998.555859856817f}};

    std::vector<std::complex<float>> expected = {
        {1.0000000, 0.0000000},
        {-0.13120436668395996, 4.4717264175415039},
        {6.1230801, 41.4808630},
        {-1.1933000, 3.2624252},
        {-390.9341747, 1000.5058599},
    };

    // CALL FUNCTION ----------------------------------------------------------------------------
    math_std::combine_inplace<std::complex<float>>(actual, input2);

    // COMAPRE RESULTS --------------------------------------------------------------------------
    gtest_utils::test::compare_spans<std::complex<float>>(expected, actual,1e-6);
}
